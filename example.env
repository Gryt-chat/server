# WebSocket Voice Chat Server Configuration
# Copy this file to .env and fill in your actual values

# Port clients connect to (optional, defaults to 5000)
# PORT=5000

# Your secure SFU host (WebRTC signaling server)
SFU_WS_HOST="wss://your-sfu-server.com"

# Comma separated list of STUN servers for WebRTC
STUN_SERVERS="stun:stun.l.google.com:19302,stun:stun1.l.google.com:19302"

# Voice capacity ("seats")
# If VOICE_MAX_USERS is not set, the server derives seats from SFU_UDP_PORT_MIN/MAX (max-min+1)
# VOICE_MAX_USERS=200
SFU_UDP_PORT_MIN=10000
SFU_UDP_PORT_MAX=10019

# Display name for the server (optional)
# SERVER_NAME="My Voice Server"

# Websocket allowed origins (use "*" for development, specific domains for production)
# Always include https://app.gryt.chat to allow the hosted web client to connect.
# Include http://127.0.0.1:15738 to allow the Electron desktop app.
CORS_ORIGIN="http://127.0.0.1:15738,https://app.gryt.chat"

# Server-to-SFU shared secret (NOT a user join password). Optional.
# Leave empty unless you need to restrict SFU registrations.
# SERVER_PASSWORD="your-internal-sfu-shared-secret"

# Invite brute-force protection (optional)
# Two-tier: per (IP + user) and per IP. Cooldowns escalate exponentially
# on repeated lockouts (base × 2^(n-1)), capped at MAX_COOLDOWN.
# SERVER_INVITE_MAX_RETRIES=8            # per (IP+user) invalid invites before lockout
# SERVER_INVITE_RETRY_WINDOW_MS=300000   # sliding window for attempt counting (5 min)
# SERVER_INVITE_RETRY_COOLDOWN_MS=60000  # base cooldown after lockout (1 min)
# SERVER_INVITE_MAX_COOLDOWN_MS=3600000  # escalation cap (1 hour)
# SERVER_INVITE_IP_MAX_RETRIES=20        # per-IP invalid invites (across all users) before lockout

# JWT secret for signing access tokens (REQUIRED in production)
# Generate with: openssl rand -base64 48
JWT_SECRET=change-me-in-production

# Refresh token lifetime in days (default: 7)
# REFRESH_TOKEN_TTL_DAYS=7

# Gryt central authentication (Keycloak / OIDC)
# - required: users must sign in with a Gryt account to join
# - disabled: nobody can join (opt-out mode)
GRYT_AUTH_MODE=required

# Keycloak realm issuer URL (used for JWKS + signature verification)
GRYT_OIDC_ISSUER=https://auth.gryt.chat/realms/gryt

# Expected audience/client for the access token (checked against `azp` and/or `aud`)
GRYT_OIDC_AUDIENCE=gryt-web

# ScyllaDB / Cassandra settings
SCYLLA_CONTACT_POINTS=your-scylla-host.com
SCYLLA_LOCAL_DATACENTER=datacenter1
# IMPORTANT: if you run multiple Gryt servers against the same Scylla cluster,
# each server instance MUST use its own keyspace (e.g. ws1, ws2).
SCYLLA_KEYSPACE=your_keyspace_name
SCYLLA_USERNAME=your_scylla_username
SCYLLA_PASSWORD=your_scylla_password

# S3 / Object storage (AWS S3, Cloudflare R2, Wasabi, MinIO)
S3_REGION=auto
S3_ENDPOINT=https://your-s3-endpoint.com
S3_ACCESS_KEY_ID=your_s3_access_key
S3_SECRET_ACCESS_KEY=your_s3_secret_key
S3_BUCKET=your-bucket-name
S3_FORCE_PATH_STYLE=true

# Additional channels configuration (JSON array of channel objects)
ADDITIONAL_CHANNELS=[{"name":"Announcements","type":"text","id":"announcements","description":"Server announcements and important updates"}]

# Example additional channels:
# ADDITIONAL_CHANNELS=[
#   {"name":"General","type":"text","id":"general","description":"General discussion"},
#   {"name":"Voice Chat","type":"voice","id":"voice","description":"Main voice channel"},
#   {"name":"Announcements","type":"text","id":"announcements","description":"Server announcements"}
# ]

# Join is invite-only once an owner exists. Create invites from the client under Server settings → Invites.