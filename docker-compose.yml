services:
  ws1:
    build:
      context: ..
      dockerfile: Dockerfile.server
    container_name: gryt-ws1
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      - SERVER_NAME=ws1
      - DATA_DIR=/data
      - SERVER_INSTANCE_ID=ws1
    volumes:
      - gryt-ws1-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:5000/health').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  ws2:
    build:
      context: ..
      dockerfile: Dockerfile.server
    container_name: gryt-ws2
    ports:
      - "5001:5001"
    environment:
      - PORT=5001
      - SERVER_NAME=ws2
      - DATA_DIR=/data
      - SERVER_INSTANCE_ID=ws2
    volumes:
      - gryt-ws2-data:/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:5001/health').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  gryt-ws1-data:
  gryt-ws2-data:
